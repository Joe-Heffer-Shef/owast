{% extends "layout.html" %}
{% set title = 'Create relationship' %}
{% set icon = 'diagram-2-fill' %}
{% block content %}
<pre>{{ request.args }}</pre>
<p>Create a PROV-DM relation pointing <em>from</em> the first item
    <em>to</em> the item that influenced it.</p>
{% if not influencer_schema %}
<div class="alert alert-primary">Select an object to relate to below.</div>
{% endif -%}

<div class="row">
    <!-- To -->
    <div class="col border rounded border-primary">
        <h2>To</h2>
        <dl>
            {% if influencer_schema -%}
            <dt>Research Object</dt>
            <dd>{{ influencer_schema.title }}</dd>
            <dt>PROV Type</dt>
            <dd>{{ influencer_schema.prov_type }}</dd>
            {% else -%}
            <form method="get" action="{{ url_for(request.endpoint) }}">
                <input type="hidden" name="influencee_schema_id" value="{{ influencee_schema._id }}">
                <input type="hidden" name="influencee_id" value="{{ from_doc._id }}">
                <label for="influencer_schema_id">Research Object</label>
                <select class="form-select" id="influencer_schema_id" name="influencer_schema_id"
                    aria-label="Select schema">
                {% for schema in research_objects -%}
                    <option value="{{ schema._id }}">{{ schema.title }}</option>
                {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">Select</button>
            </form>
            {% endif -%}
            {% if influencer_schema and not influencer -%}
            <form method="get" action="{{ url_for(request.endpoint) }}">
                <input type="hidden" name="influencee_schema_id" value="{{ influencee_schema._id }}">
                <input type="hidden" name="influencee_id" value="{{ from_doc._id }}">
                <input type="hidden" name="influencer_schema_id" value="{{ influencer_schema._id }}">
                <label for="influencer_id">Instance</label>
                <select class="form-select" id="influencer_id" name="influencer_id" aria-label="Select instance">
                {% for instance_id, instance in instances -%}
                    <option value="{{ instance_id }}">
                        {{ instance|tojson }}
                    </option>
                {% endfor -%}
                </select>
                <button type="submit" class="btn btn-primary">Select</button>
            </form>
            {% endif -%}
            {% if influencer %}
            {% for key, value in influencer.items() if not key.startswith('_') and value -%}
            <dt>{{ key }}</dt>
            <dd><code>{{ value | tojson }}</code></dd>
            {% endfor %}
            {% endif %}
        </dl>
    </div>

    <!-- Relation -->
    <div class="col">
        <h2><span class="bi bi-arrow-left"></span> Relation</h2>
        {% if influencer_schema %}
        <dl>
            <dt>Relation Type</dt>
            <dd>{{ relation.type }}</dd>
        </dl>
        {% if influencer %}
        <form method="post" action="{{ url_for(request.endpoint) }}">
            {% for field in form -%}
            {% if field.__class__.__name__ !='ObjectIdStringField' -%}
                {{ field.label(class='form-label') }}
            {% endif -%}
            {{ field(class='form-control') }}
            {% endfor -%}
            <button class="btn btn-primary">
                <span class="bi bi-diagram-2-fill"></span> Create</button>
        </form>
        {% else %}
        <div class="alert alert-warning">Select an instance to relate to.</div>
        {% endif %}
        {% else %}
        <div class="alert alert-warning">
            Select an research object to relate to.</div>
        {% endif %}
    </div>

    <!-- From -->
    <div class="col border rounded border-primary">
        <h2><span class="bi bi-{{ influencee_schema.icon or 'cup' }}"></span> From</h2>
        <dl>
            <dt>Research Object</dt>
            <dd>{{ influencee_schema.title }}</dd>
            <dt>PROV Type</dt>
            <dd>{{ influencee_schema.prov_type }}</dd>
            {% for key, value in from_doc.items() if not key.startswith('_') and value %}
                <dt>{{ key }}</dt>
                <dd><code>{{ value | tojson }}</code></dd>
            {% endfor %}
        </dl>
    </div>
</div>
{% endblock %}
